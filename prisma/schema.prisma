generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Species {
  CAT
  DOG
}

enum PendingStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum PendingCategory {
  VACCINATION
  TREATMENT
  VET_CONTROL
  SURGERY
  HYGINE
  GENERAL_REVISION
  AESTHETICS
}

model User {
  id            Int            @id @default(autoincrement())
  name          String
  phone         String         @unique
  pets          Pet[]          @relation("UserPets")
  pendings      Pending[]
  AuthToken     AuthToken[]
  consultations Consultation[]
}

model AuthToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  phone     String
  userId    Int
  createdAt DateTime @default(now())
  expiresAt DateTime
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id])

  @@index([token])
  @@index([phone])
}

model Pet {
  id            Int            @id @default(autoincrement())
  name          String
  dateOfBirth   DateTime
  species       Species
  owners        User[]         @relation("UserPets")
  consultations Consultation[]
  pendings      Pending[]
}

model Pending {
  id             Int             @id @default(autoincrement())
  title          String
  description    String?
  location       String?
  status         PendingStatus
  category       PendingCategory
  date           DateTime?
  reminderConfig Json?
  user           User            @relation(fields: [userId], references: [id])
  pet            Pet             @relation(fields: [petId], references: [id])
  userId         Int
  petId          Int
  reminder       Reminder[]
}

model Reminder {
  id           Int      @id @default(autoincrement())
  pendingId    Int
  scheduledFor DateTime
  sent         Boolean  @default(false)
  pending      Pending  @relation(fields: [pendingId], references: [id], onDelete: Cascade)

  @@index([scheduledFor])
  @@index([sent])
}

model Consultation {
  id              Int      @id @default(autoincrement())
  petId           Int
  userId          Int
  date            DateTime
  chiefComplaint  String
  findings        String?
  diagnosis       String?
  treatment       String?
  nextSteps       String?
  additionalNotes String?
  createdAt       DateTime @default(now())

  pet  Pet  @relation(fields: [petId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@index([petId])
  @@index([userId])
  @@index([date])
}
